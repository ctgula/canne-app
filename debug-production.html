<!DOCTYPE html>
<html>
<head>
    <title>Debug Production Issue</title>
</head>
<body>
    <h1>Production Checkout Debug</h1>
    <div id="output"></div>
    
    <script>
        // Test the production API directly
        const testOrder = {
          items: [
            {
              product: {
                id: "ddc696a0-a537-4d10-b820-584c6c512bff", // Real Starter product
                name: "Starter",
                price: 25,
                tier: "starter",
                weight: "3.5g",
                color_theme: "Pink"
              },
              strain: {
                name: "OG Kush",
                type: "Indica",
                thcLow: 18,
                thcHigh: 22
              },
              quantity: 1
            }
          ],
          deliveryDetails: {
            name: "Production Test",
            phone: "2025551234",
            email: "test@example.com",
            address: "123 Test St NW",
            city: "Washington",
            zipCode: "20001"
          },
          total: 35,
          hasDelivery: false,
          status: 'pending'
        };

        console.log('Testing production API...');
        
        fetch('https://canne-app-git-main-ctgula123s-projects.vercel.app/api/place-order', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(testOrder)
        })
        .then(response => {
          console.log('Production API Status:', response.status);
          console.log('Response Headers:', Object.fromEntries(response.headers.entries()));
          return response.text();
        })
        .then(text => {
          console.log('Raw Response:', text);
          document.getElementById('output').innerHTML = `
            <h2>Production API Test Results:</h2>
            <pre>${text}</pre>
            
            <h3>Analysis:</h3>
            <div style="background: #f0f0f0; padding: 10px; margin: 10px 0;">
              ${text.includes('success') ? 
                '✅ API is working - issue might be with cart data' : 
                '❌ API is failing - likely environment variable or database issue'
              }
            </div>
          `;
          
          try {
            const data = JSON.parse(text);
            if (data.success) {
              console.log('✅ Production API working!');
            } else {
              console.log('❌ Production API error:', data.error);
            }
          } catch (e) {
            console.log('❌ Response is not JSON - server error');
          }
        })
        .catch(error => {
          console.error('❌ Request failed:', error);
          document.getElementById('output').innerHTML = `
            <h2>Production API Test Failed:</h2>
            <p style="color: red;">${error.message}</p>
          `;
        });
    </script>
</body>
</html>
